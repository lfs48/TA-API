generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Status {
  PENDING
  ACCEPTED
  REJECTED
}

model User {
  id       String @id @default(uuid())
  username String @unique
  password String

  gmGames     Game[] @relation("GM Games")
  playerGames Game[] @relation("Player")

  agents Agent[] @relation("Player")

  invitesReceived Invite[] @relation("Invitee")
  invitesSent     Invite[] @relation("Inviter")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Game {
  id          String  @id @default(uuid())
  title       String
  description String?
  active      Boolean @default(true)
  passphrase  String  @unique

  gm   User?  @relation("GM Games", fields: [gmID], references: [id])
  gmID String

  players User[] @relation("Player")

  invites Invite[]

  agents Agent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Invite {
  id String @id @default(uuid())

  game   Game   @relation(fields: [gameId], references: [id])
  gameId String

  invitee   User   @relation("Invitee", fields: [inviteeId], references: [id])
  inviteeId String

  inviter   User   @relation("Inviter", fields: [inviterId], references: [id])
  inviterId String

  status Status @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Agent {
  id   String @id @default(uuid())
  name String @default("")

  qualities Json @default("{\"attentiveness\":{\"current\":0,\"max\":0},\"duplicity\":{\"current\":0,\"max\":0},\"dynamism\":{\"current\":0,\"max\":0},\"empathy\":{\"current\":0,\"max\":0},\"initiative\":{\"current\":0,\"max\":0},\"persistence\":{\"current\":0,\"max\":0},\"presence\":{\"current\":0,\"max\":0},\"professionalism\":{\"current\":0,\"max\":0},\"subtlety\":{\"current\":0,\"max\":0}}")
  currency Json @default("{\"commendations\":{\"current\":0,\"banked\":0,\"spent\":0},\"demerits\":{\"current\":0,\"banked\":0,\"spent\":0}}")

  game   Game   @relation(fields: [gameId], references: [id])
  gameId String

  player   User   @relation("Player", fields: [playerId], references: [id])
  playerId String

  anomaly   Anomaly? @relation(fields: [anomalyId], references: [id])
  anomalyId String?

  reality   Reality? @relation(fields: [realityId], references: [id])
  realityId String?

  competency   Competency? @relation(fields: [competencyId], references: [id])
  competencyId String?

  abilityInstances AbilityInstance[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Anomaly {
  id String @id @default(uuid())

  name String @default("")

  agents     Agent[]

  abilities  Ability[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

}

model Ability {
  id String @id @default(uuid())

  title String @default("")
  data Json @default("{}")

  anomaly Anomaly @relation(fields: [anomalyId], references: [id])
  anomalyId String

  abilityInstances AbilityInstance[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AbilityInstance {
  id String @id @default(uuid())

  practiced Boolean @default(false)
  answers Json @default("{}")

  ability   Ability   @relation(fields: [abilityId], references: [id])
  abilityId String

  agent   Agent   @relation(fields: [agentId], references: [id])
  agentId String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Reality {
  id String @id @default(uuid())

  name String @default("")

  Agent     Agent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

}

model Competency {
  id String @id @default(uuid())

  name String @default("")

  Agent     Agent[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

}
